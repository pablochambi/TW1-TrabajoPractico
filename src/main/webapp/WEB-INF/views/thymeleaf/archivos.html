<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Boostrap core css -->
  <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.0/css/bootstrap.min.css}"/>

  <!--ICONOS DE FONT AWESOME-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer">

  <!-- Mis estilos -->
  <link rel="stylesheet" th:href="@{/css/main.css}"/>

  <title>Archivos</title>
</head>

<body>
  <!--Header-->
  <div th:insert="templates/header :: header"></div>

  <h2>Subir Archivo</h2>
  <a class="nav-link" th:href="@{/subirArchivo}">Subir Archivo</a>

  <h2>Lista de Archivos Subidos:</h2>

  <!-- Tabla de archivos -->
  <div class="container mt-4">
    <table id="tablaArchivos" class="table table-striped table-bordered">
      <thead class="table-dark">
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Nombre</th>
        <th scope="col">Peso (MB)</th>
        <th scope="col">Usuario ID</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="arch : ${archivos}">
        <td>
          <p th:text="${arch.id}"></p>
        </td>
        <td>
          <p th:text="${arch.nombre}"></p>
        </td>
        <td>
          <p th:text="${arch.peso}"></p>
        </td>
        <td>
          <p th:text="${arch.usuario}"></p>
        </td>
      </tr>
      </tbody>
    </table>
  </div>




  <!-- jQuery Script para actualizar la tabla -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <script>/*
    $(document).ready(function() {
      // Funci칩n para cargar la lista de archivos
      function cargarArchivos() {
        $.ajax({
          url: '/spring/archivos/lista', // URL que devuelve la lista de archivos en JSON
          type: 'GET',
          dataType: 'json',
          cache: false,
          success: function(data) {
            // Limpiar la tabla antes de agregar los nuevos datos
            $('#tablaArchivos tbody').empty();

            // Mostrar la lista de archivos en la consola
            console.log('Lista de archivos recibida:', data);

            // Iterar sobre la lista de archivos y a침adir filas a la tabla
            $.each(data, function(index, archivo) {

              let eliminarUrl = `/spring/archivos/eliminar?archivo_id=${archivo.id}`;

              $('#tablaArchivos tbody').append(
                      `<tr>
                        <td>${archivo.id}</td>
                        <td>${archivo.nombre}</td>
                        <td>${archivo.tipo}</td>
                        <td>${archivo.peso.toFixed(2)}</td>
                        <td>
                          <a href="${eliminarUrl}" class="btn btn-danger btn-sm">Eliminar</a>
                        </td>
                      </tr>`
              );
            });
          },
          error: function(xhr, status, error) {
            console.error('Error al cargar archivos:', error);
          }
        });
      }

      // Llamar a la funci칩n para cargar los archivos al inicializar la p치gina
      cargarArchivos();

    });*/
  </script>

  <!-- Boostrap core javascript -->
  <script type="text/javascript" th:src="@{webjars/bootstrap/5.2.0/js/bootstrap.min.js}"></script>

</body>
</html>